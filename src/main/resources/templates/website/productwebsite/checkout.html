<!DOCTYPE html>
<html lang="html" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{/website/layout/layout}">
<meta http-equiv="content-type" content="text/html;charset=UTF-8"/><!-- /Added by HTTrack -->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

    <title>HONO - Multi Purpose HTML Template</title>
<style>
    .out-of-stock-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(255, 255, 255, 0.7); /* Màu nền overlay, có thể điều chỉnh độ trong suốt tùy ý */
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .circle {
        width: 100px; /* Đặt kích thước hình tròn */
        height: 100px; /* Đặt kích thước hình tròn */
        background-color: red; /* Đặt màu nền hình tròn */
        border-radius: 50%; /* Làm hình tròn */
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .out-of-stock-text {
        color: white; /* Màu chữ trong hình tròn */
        margin: 0; /* Loại bỏ margin để chữ không bị dính vào mép hình tròn */
    }

    /* Optional: Thiết lập margin hoặc padding cho mỗi product container nếu cần thiết */
    #product-container {
        margin-bottom: 20px; /* Ví dụ: Đặt margin dưới cho mỗi product container */
    }
    .page-pagination ul li.active a {
        /* Màu cho trang đã chọn */
        background-color: #B19361!important;
        color: #fff!important;
        /* Các thuộc tính khác tùy thuộc vào thiết kế của bạn */
    }

    .page-pagination ul li a {
        /* Màu cho các trang không được chọn */
        background-color: #fff!important;
        color: #000!important;
        /* Các thuộc tính khác tùy thuộc vào thiết kế của bạn */
    }

    .sidebar-content::-webkit-scrollbar {
        width: 6px; /* Đặt chiều rộng của thanh cuộn */
    }

    .sidebar-content::-webkit-scrollbar-thumb {
        background-color: #B19361; /* Màu nền của thanh cuộn */
        border-radius: 4px; /* Độ cong của góc thanh cuộn */
    }

    .sidebar-content::-webkit-scrollbar-track {
        background-color: #f1f1f1; /* Màu nền của phần dưới thanh cuộn */
        border-radius: 4px; /* Độ cong của góc phần dưới thanh cuộn */
    }
</style>

</head>

<body layout:fragment="content2">
<!-- Start Header Area -->
<!-- Start Mobile Header -->
<div class="mobile-header mobile-header-bg-color--golden section-fluid d-lg-block d-xl-none">
    <div class="container">
        <div class="row">
            <div class="col-12 d-flex align-items-center justify-content-between">
                <!-- Start Mobile Left Side -->
                <div class="mobile-header-left">
                    <ul class="mobile-menu-logo">
                        <li>
                            <a href="../websiteShop/index.html">
                                <div class="logo">
                                    <img src="/assets/images/logo/logo_black.png" alt="">
                                </div>
                            </a>
                        </li>
                    </ul>
                </div>
                <!-- End Mobile Left Side -->

                <!-- Start Mobile Right Side -->
                <div class="mobile-right-side">
                    <ul class="header-action-link action-color--black action-hover-color--golden">
                        <li>
                            <a href="#search">
                                <i class="icon-magnifier"></i>
                            </a>
                        </li>
                        <li>
                            <a href="#offcanvas-wishlish" class="offcanvas-toggle">
                                <i class="icon-heart"></i>
                                <span class="item-count">3</span>
                            </a>
                        </li>
                        <li>
                            <a href="#offcanvas-add-cart" class="offcanvas-toggle">
                                <i class="icon-bag"></i>
                                <span class="item-count">3</span>
                            </a>
                        </li>
                        <li>
                            <a href="#mobile-menu-offcanvas" class="offcanvas-toggle offside-menu">
                                <i class="icon-menu"></i>
                            </a>
                        </li>
                    </ul>
                </div>
                <!-- End Mobile Right Side -->
            </div>
        </div>
    </div>
</div>
<!-- End Mobile Header -->

<!--  Start Offcanvas Mobile Menu Section -->
<div id="mobile-menu-offcanvas" class="offcanvas offcanvas-rightside offcanvas-mobile-menu-section">
    <!-- Start Offcanvas Header -->
    <div class="offcanvas-header text-right">
        <button class="offcanvas-close"><i class="ion-android-close"></i></button>
    </div> <!-- End Offcanvas Header -->
    <!-- Start Offcanvas Mobile Menu Wrapper -->
    <div class="offcanvas-mobile-menu-wrapper">
        <!-- Start Mobile Menu  -->
        <div class="mobile-menu-bottom">
            <!-- Start Mobile Menu Nav -->
            <div class="offcanvas-menu">
                <ul>
                    <li>
                        <a href="#"><span>Home</span></a>
                        <ul class="mobile-sub-menu">
                            <li><a href="../websiteShop/index.html">Home 1</a></li>
                            <li><a href="index-2.html">Home 2</a></li>
                            <li><a href="../websiteShop/index.html">Home 3</a></li>
                            <li><a href="index-4.html">Home 4</a></li>
                        </ul>
                    </li>
                    <li>
                        <a href="#"><span>Shop</span></a>
                        <ul class="mobile-sub-menu">
                            <li>
                                <a href="#">Shop Layout</a>
                                <ul class="mobile-sub-menu">
                                    <li><a href="shop-grid-sidebar-left.html">Grid Left Sidebar</a></li>
                                    <li><a href="../shop-grid-sidebar-right.html">Grid Right Sidebar</a></li>
                                    <li><a href="../shop-full-width.html">Full Width</a></li>
                                    <li><a href="../shop-list-sidebar-left.html">List Left Sidebar</a></li>
                                    <li><a href="../shop-list-sidebar-right.html">List Right Sidebar</a></li>
                                </ul>
                            </li>
                        </ul>
                        <ul class="mobile-sub-menu">
                            <li>
                                <a href="#">Shop Pages</a>
                                <ul class="mobile-sub-menu">
                                    <li><a href="../cart.html">Cart</a></li>
                                    <li><a href="empty-cart.html">Empty Cart</a></li>
                                    <li><a href="../wishlist.html">Wishlist</a></li>
                                    <li><a href="../compare.html">Compare</a></li>
                                    <li><a href="checkout.html">Checkout</a></li>
                                    <li><a href="../login.html">Login</a></li>
                                    <li><a href="my-account.html">My Account</a></li>
                                </ul>
                            </li>
                        </ul>
                        <ul class="mobile-sub-menu">
                            <li>
                                <a href="#">Product Single</a>
                                <ul class="mobile-sub-menu">
                                    <li><a href="../product-details-default.html">Product Default</a></li>
                                    <li><a href="../product-details-variable.html">Product Variable</a></li>
                                    <li><a href="../product-details-affiliate.html">Product Referral</a></li>
                                    <li><a href="../product-details-group.html">Product Group</a></li>
                                    <li><a href="../product-details-single-slide.html">Product Slider</a></li>
                                    <li><a href="../product-details-tab-left.html">Product Tab Left</a></li>
                                    <li><a href="../product-details-tab-right.html">Product Tab Right</a></li>
                                    <li><a href="../product-details-gallery-left.html">Product Gallery Left</a></li>
                                    <li><a href="../product-details-gallery-right.html">Product Gallery Right</a></li>
                                    <li><a href="../product-details-sticky-left.html">Product Sticky Left</a></li>
                                    <li><a href="../product-details-sticky-right.html">Product Sticky right</a></li>
                                </ul>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <a href="#"><span>Blogs</span></a>
                        <ul class="mobile-sub-menu">
                            <li>
                                <a href="#">Blog Grid</a>
                                <ul class="mobile-sub-menu">
                                    <li><a href="../blog-grid-sidebar-left.html">Blog Grid Sidebar left</a></li>
                                    <li><a href="../blog-grid-sidebar-right.html">Blog Grid Sidebar Right</a></li>
                                </ul>
                            </li>
                            <li>
                                <a href="../blog-full-width.html">Blog Full Width</a>
                            </li>
                            <li>
                                <a href="#">Blog List</a>
                                <ul class="mobile-sub-menu">
                                    <li><a href="../blog-list-sidebar-left.html">Blog List Sidebar left</a></li>
                                    <li><a href="../blog-list-sidebar-right.html">Blog List Sidebar Right</a></li>
                                </ul>
                            </li>
                            <li>
                                <a href="#">Blog Single</a>
                                <ul class="mobile-sub-menu">
                                    <li><a href="../blog-single-sidebar-left.html">Blog Single Sidebar left</a></li>
                                    <li><a href="../blog-single-sidebar-right.html">Blog Single Sidebar Right</a></li>
                                </ul>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <a href="#"><span>Pages</span></a>
                        <ul class="mobile-sub-menu">
                            <li><a href="../faq.html">Frequently Questions</a></li>
                            <li><a href="../privacy-policy.html">Privacy Policy</a></li>
                            <li><a href="../404.html">404 Page</a></li>
                        </ul>
                    </li>
                    <li><a href="../about-us.html">About Us</a></li>
                    <li><a href="../contact-us.html">Contact Us</a></li>
                </ul>
            </div> <!-- End Mobile Menu Nav -->
        </div> <!-- End Mobile Menu -->

        <!-- Start Mobile contact Info -->
        <div class="mobile-contact-info">
            <div class="logo">
                <a href="../websiteShop/index.html"><img src="/assets/images/logo/logo_white.png" alt=""></a>
            </div>

            <address class="address">
                <span>Address: Your address goes here.</span>
                <span>Call Us: 0123456789, 0123456789</span>
                <span>Email: demo@example.com</span>
            </address>

            <ul class="social-link">
                <li><a href="#"><i class="fa fa-facebook"></i></a></li>
                <li><a href="#"><i class="fa fa-twitter"></i></a></li>
                <li><a href="#"><i class="fa fa-instagram"></i></a></li>
                <li><a href="#"><i class="fa fa-linkedin"></i></a></li>
            </ul>

            <ul class="user-link">
                <li><a href="../wishlist.html">Wishlist</a></li>
                <li><a href="../cart.html">Cart</a></li>
                <li><a href="checkout.html">Checkout</a></li>
            </ul>
        </div>
        <!-- End Mobile contact Info -->

    </div> <!-- End Offcanvas Mobile Menu Wrapper -->
</div> <!-- ...:::: End Offcanvas Mobile Menu Section:::... -->

<!-- Start Offcanvas Mobile Menu Section -->
<div id="offcanvas-about" class="offcanvas offcanvas-rightside offcanvas-mobile-about-section">
    <!-- Start Offcanvas Header -->
    <div class="offcanvas-header text-right">
        <button class="offcanvas-close"><i class="ion-android-close"></i></button>
    </div> <!-- End Offcanvas Header -->
    <!-- Start Offcanvas Mobile Menu Wrapper -->
    <!-- Start Mobile contact Info -->
    <div class="mobile-contact-info">
        <div class="logo">
            <a href="../websiteShop/index.html"><img src="/assets/images/logo/logo_white.png" alt=""></a>
        </div>

        <address class="address">
            <span>Address: Your address goes here.</span>
            <span>Call Us: 0123456789, 0123456789</span>
            <span>Email: demo@example.com</span>
        </address>

        <ul class="social-link">
            <li><a href="#"><i class="fa fa-facebook"></i></a></li>
            <li><a href="#"><i class="fa fa-twitter"></i></a></li>
            <li><a href="#"><i class="fa fa-instagram"></i></a></li>
            <li><a href="#"><i class="fa fa-linkedin"></i></a></li>
        </ul>

        <ul class="user-link">
            <li><a href="../wishlist.html">Wishlist</a></li>
            <li><a href="../cart.html">Cart</a></li>
            <li><a href="checkout.html">Checkout</a></li>
        </ul>
    </div>
    <!-- End Mobile contact Info -->
</div> <!-- ...:::: End Offcanvas Mobile Menu Section:::... -->

<!-- Start Offcanvas Addcart Section -->
<div id="offcanvas-add-cart" class="offcanvas offcanvas-rightside offcanvas-add-cart-section">
    <div class="offcanvas-header text-right">
        <button class="offcanvas-close"><i class="ion-android-close"></i></button>
    </div>
    <div class="offcanvas-add-cart-wrapper">
        <h4 class="offcanvas-title">Giỏ hàng</h4>
        <ul class="offcanvas-cart">
            <li class="offcanvas-cart-item-single" th:each="cart : ${cartItems}">
                <div class="offcanvas-cart-item-block">
                    <a href="#" class="offcanvas-cart-item-image-link">
                        <img class="offcanvas-cart-image"
                             th:src="@{${cart.id.chiTietGiay.anhs.get(0).getDuongDan()}}"
                             style="width: 92px; height: 92px"
                             alt="">
                    </a>
                    <div class="offcanvas-cart-item-content">
                        <a href="#" class="offcanvas-cart-item-link"
                           th:text="${cart.id.chiTietGiay.hang.ten + ' ' + cart.id.chiTietGiay.giay.ten + ' ' + cart.id.chiTietGiay.loaiGiay.ten + ' ' + cart.id.chiTietGiay.mauSac.ten}"></a>
                        <div class="offcanvas-cart-item-details">
                            <span class="offcanvas-cart-item-details-quantity" th:text="${cart.soLuong} + ' x'"></span>
                            <span class="offcanvas-cart-item-details-price"
                                  th:text="${#numbers.formatCurrency(cart.id.chiTietGiay.gia * cart.soLuong)}"></span>
                        </div>
                    </div>
                </div>
                <div class="offcanvas-cart-item-delete text-right">
                    <a href="#" class="offcanvas-cart-item-delete"><i class="fa fa-trash-o"></i></a>
                </div>
            </li>

        </ul>
        <div class="offcanvas-cart-total-price">
            <span class="offcanvas-cart-total-price-text">Subtotal:</span>
            <span class="offcanvas-cart-total-price-value" th:text="${#numbers.formatCurrency(totalCartPrice)}"></span>
        </div>
        <ul class="offcanvas-cart-action-button">
            <li><a th:href="@{/cart/hien-thi}" class="btn btn-block btn-golden">Giỏ hàng</a></li>
            <li><a href="compare.html" class=" btn btn-block btn-golden mt-5">Checkout</a></li>
        </ul>
    </div> <!-- End  Offcanvas Addcart Wrapper -->
</div>
<!-- Start Offcanvas Mobile Menu Section -->
<!-- Start Offcanvas Search Bar Section -->
<div id="search" class="search-modal">
    <button type="button" class="close">×</button>
    <form>
        <input type="search" placeholder="type keyword(s) here"/>
        <button type="submit" class="btn btn-lg btn-golden">Search</button>
    </form>
</div>
<!-- End Offcanvas Search Bar Section -->

<!-- Offcanvas Overlay -->
<div class="offcanvas-overlay"></div>

<!-- ...:::: Start Breadcrumb Section:::... -->
<div class="breadcrumb-section breadcrumb-bg-color--golden">
    <div class="breadcrumb-wrapper">
        <div class="container">
            <div class="row">
                <div class="col-12">
                    <h3 class="breadcrumb-title">Thanh toán</h3>
                    <div class="breadcrumb-nav breadcrumb-nav-color--black breadcrumb-nav-hover-color--golden">
                        <nav aria-label="breadcrumb">
                            <ul>
                                <li><a th:href="@{/sophia-store/home}">Trang chủ</a></li>
                                <li><a th:href="@{/sophia-store/product}">Sản phẩm</a></li>
                                <li class="active" aria-current="page">Thanh toán</li>
                            </ul>
                        </nav>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div> <!-- ...:::: End Breadcrumb Section:::... -->

<!-- ...:::: Start Checkout Section:::... -->
<div class="checkout-section">
    <div class="container">
        <form th:object="${diaChi}" th:action="@{/check-out/thanh-toan}" method="post" id="formThanhToan">

            <!-- Start User Details Checkout Form -->
            <div class="checkout_form" data-aos="fade-up" data-aos-delay="400">
                <div class="row">
                    <div class="col-lg-6 col-md-6">
                        <h3>Thông tin địa chỉ</h3>
                        <div class="row">
                            <div class="col-12">
                                <div class="default-form-box">
                                    <label>Họ tên người nhận hàng</label>
                                    <input type="text" th:field="*{ten}" id="nameTen">
                                    <span th:errors="*{ten}" style="color: red"></span>
                                </div>
                            </div>
                            <div class="col-lg-6">
                                <div class="default-form-box">
                                    <label>Số điện thoại <span>*</span></label>
                                    <input type="text" th:field="*{sdt}" id="nameSoDienThoai">
                                    <span th:errors="*{sdt}" style="color: red"></span>
                                </div>
                            </div>
                            <div class="col-lg-6">
                                <div class="default-form-box">
                                    <label> Địa chỉ email <span>*</span></label>
                                    <input type="text" th:value="${email}" disabled>
                                    <!--                                                                        <span th:errors="*{taiKhoan.email}" style="color: red"></span>-->
                                </div>
                            </div>
                            <div class="col-4">
                                <div class="default-form-box">
                                    <label for="province">Tỉnh<span>*</span></label>
                                    <select class="country_option nice-select wide" id="province"
                                            th:field="*{tinh}" placeholder="Chọn tỉnh">
                                        <option value="">Chọn tỉnh</option>
                                        <option value=""></option>
                                    </select>
                                    <span th:errors="*{tinh}" style="color: red"></span>
                                </div>
                            </div>
                            <div class="col-4">
                                <div class="default-form-box">
                                    <label for="district">Huyện <span>*</span></label>
                                    <select class="country_option nice-select wide" id="district"
                                            th:field="*{quanHuyen}" placeholder="Chọn huyện">
                                        <option value="">Chọn quận huyện</option>
                                        <option value=""></option>
                                    </select>
                                    <span th:errors="*{quanHuyen}" style="color: red"></span>
                                </div>
                            </div>
                            <div class="col-4">
                                <div class="default-form-box">
                                    <label for="ward">Xã <span>*</span></label>
                                    <select class="country_option nice-select wide" id="ward"
                                            th:field="*{phuongXa}" placeholder="Chọn xã">
                                        <option value="">Chọn phường xã</option>
                                        <option value=""></option>
                                    </select>
                                    <span th:errors="*{phuongXa}" style="color: red"></span>
                                </div>
                            </div>


                            <div class="col-8">
                                <div class="default-form-box">
                                    <label>Địa chỉ cụ thể <span>*</span></label>
                                    <input placeholder="House number and street name" type="text" id="nameDiaChiCuThe"
                                           th:field="*{diaChiCuThe}">
                                    <span th:errors="*{diaChiCuThe}" style="color: red"></span>
                                </div>
                            </div>
                            <div class="col-4">
                                <div class="default-form-box">
                                    <button type="button" onclick="loadAllDC();" class="btn btn-golden mt-8"
                                            data-bs-toggle="modal"
                                            data-bs-target="#modalDoiDiaChi">
                                        Đổi địa chỉ
                                    </button>
                                </div>
                            </div>
                            <div class="col-12">
                                <div class="default-form-box">
                                    <label for="nameGhiChu">Ghi chú</label>
                                    <textarea id="nameGhiChu" name="ghiChu" style="height: 100px;"></textarea>
                                    <span id="errorGhiChu" style="color: red"></span>
                                </div>
                            </div>
                            <div class="col-12">
                                <label class="checkbox-default">
                                    <input type="radio" name="giaoHang" checked>
                                    <span class="font-weight-bold">Giao hàng tiêu chuẩn</span>
                                    <br>
                                    <br>
                                    <span class="d-block mb-3">Miễn phí vận chuyển đối với đơn hàng từ 2.000.000đ.</span>
                                    <span class="d-block mb-3">Giao tại Hà Nội 20.000đ.</span>
                                    <span class="d-block">Các địa chỉ khác: 30.000đ</span>
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-6 col-md-6">
                        <form th:action="@{/check-out/thanh-toan}" method="post">
                            <h3>Đơn hàng của bạn</h3>
                            <div class="order_table table-responsive">
                                <table>
                                    <thead>
                                    <tr>
                                        <th>Ảnh</th>
                                        <th>Sản phẩm</th>
                                        <th>Số lượng</th>
                                        <th>Đơn giá</th>
                                        <th>Thành tiền</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr th:each="item : ${cartItems}" style="max-height: 150px;overflow-y: auto;">
                                        <td class="product_thumb">
                                            <img class="offcanvas-cart-image"
                                                 th:src="@{${item.id.chiTietGiay.anhs.get(0).getDuongDan()}}"
                                                 style="width: 92px; height: 92px"
                                                 alt="">
                                        </td>
                                        <td>
                                            <p th:text="${item.id.chiTietGiay.hang.ten + ' ' + item.id.chiTietGiay.giay.ten + ' ' + item.id.chiTietGiay.loaiGiay.ten + ' ' + item.id.chiTietGiay.mauSac.ten + '  [' + item.id.chiTietGiay.kichCo.ten + ']'}"></p>
                                        </td>
                                        <td>
                                            <p th:text="${item.soLuong}"></p>
                                        </td>
                                        <td>
                                        <span th:if="${session['giaCu_' + item.id.chiTietGiay.id] != session['giaMoi_' + item.id.chiTietGiay.id]}"
                                              class="original-price"
                                              style="text-decoration: line-through; color: red; font-size: 13px"
                                              th:text="${#numbers.formatCurrency(session['giaCu_' + item.id.chiTietGiay.id])}"></span>
                                            <br>
                                            <span class="discounted-price"
                                                  th:if="${session['giaCu_' + item.id.chiTietGiay.id] != session['giaMoi_' + item.id.chiTietGiay.id]}"
                                                  th:text="${#numbers.formatCurrency(session['giaMoi_' + item.id.chiTietGiay.id])}"></span>

                                            <span th:unless="${session['giaCu_' + item.id.chiTietGiay.id] != session['giaMoi_' + item.id.chiTietGiay.id]}"
                                                  th:text="${#numbers.formatCurrency(session['giaCu_' + item.id.chiTietGiay.id])}"></span>
                                        </td>
                                        <td>
                                            <p th:text="${#numbers.formatCurrency(session['giaMoi_' + item.id.chiTietGiay.id] * item.soLuong)}"></p>
                                        </td>
                                    </tr>
                                    </tbody>
                                    <tfoot>
                                    <tr>
                                        <td colspan="4" style="text-align: center;">Tổng giá sản phẩm</td>
                                        <td th:text="${#numbers.formatCurrency(total)}"></td>
                                    </tr>
                                    <tr>
                                        <td colspan="4" style="text-align: center;">Phí vận chuyển</td>
                                        <td id="shipping-cost" name="shipping">Vui Lòng chọn địa chỉ</td>
                                    </tr>
                                    <tr class="order_total">
                                        <td colspan="4" style="text-align: center;">Tổng tiền đơn hàng</td>
                                        <td><strong id="totalAmount" th:data-id="${total}"
                                                    th:text="${#numbers.formatCurrency(total)}"></strong>
                                        </td>
                                    </tr>
                                    </tfoot>
                                </table>
                            </div>
                            <div class="payment_method">
                                <div class="panel-default">
                                    <label class="checkbox-default" for="currencyCod" data-bs-toggle="collapse"
                                           data-bs-target="#methodCod">
                                        <input type="radio" id="currencyCod" name="hinhThucThanhToan" value="3" checked>
                                        <span>Thanh toán khi nhận hàng</span>
                                    </label>

                                    <div id="methodCod" class="collapse" data-parent="#methodCod">
                                        <div class="card-body1">
                                            <p>Vui lòng nhập địa chỉ giao và kiểm tra đúng nơi nhận hàng.</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="panel-default">
                                    <label class="checkbox-default" for="currencyPaypal" data-bs-toggle="collapse"
                                           data-bs-target="#methodPaypal">
                                        <input type="radio" id="currencyPaypal" name="hinhThucThanhToan" value="2">
                                        <span>VNPay</span>
                                    </label>
                                    <div id="methodPaypal" class="collapse " data-parent="#methodPaypal">
                                        <div class="card-body1">
                                            <p>Pay via PayPal; you can pay with your credit card if you don’t have a
                                                PayPal account.</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="order_button pt-3">
                                    <button id="btnThanhToan" class="btn btn-md btn-black-default-hover" type="submit">
                                        Thanh
                                        toán
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div> <!-- Start User Details Checkout Form -->
        </form>
    </div>
</div><!-- ...:::: End Checkout Section:::... -->


<!-- material-scrolltop button -->
<button class="material-scrolltop" type="button"></button>

<!-- Start Modal Add cart -->
<div class="modal fade" id="modalAddcart" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog  modal-dialog-centered modal-xl" role="document">
        <div class="modal-content">
            <div class="modal-body">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col text-right">
                            <button type="button" class="close modal-close" data-bs-dismiss="modal"
                                    aria-label="Close">
                                <span aria-hidden="true"> <i class="fa fa-times"></i></span>
                            </button>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-7">
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="modal-add-cart-product-img">
                                        <img class="img-fluid"
                                             src="/assets/images/product/default/home-1/default-1.jpg" alt="">
                                    </div>
                                </div>
                                <div class="col-md-8">
                                    <div class="modal-add-cart-info"><i class="fa fa-check-square"></i>Added to cart
                                        successfully!
                                    </div>
                                    <div class="modal-add-cart-product-cart-buttons">
                                        <a href="../cart.html">View Cart</a>
                                        <a href="checkout.html">Checkout</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-5 modal-border">
                            <ul class="modal-add-cart-product-shipping-info">
                                <li><strong><i class="icon-shopping-cart"></i> There Are 5 Items In Your
                                    Cart.</strong></li>
                                <li><strong>TOTAL PRICE: </strong> <span>$187.00</span></li>
                                <li class="modal-continue-button"><a href="#" data-bs-dismiss="modal">CONTINUE
                                    SHOPPING</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div> <!-- End Modal Add cart -->

<!-- Start Modal Quickview cart -->
<div class="modal fade" id="modalQuickview" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog  modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-body">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col text-right">
                            <button type="button" class="close modal-close" data-bs-dismiss="modal"
                                    aria-label="Close">
                                <span aria-hidden="true"> <i class="fa fa-times"></i></span>
                            </button>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="product-details-gallery-area mb-7">
                                <!-- Start Large Image -->
                                <div class="product-large-image modal-product-image-large swiper-container">
                                    <div class="swiper-wrapper">
                                        <div class="product-image-large-image swiper-slide img-responsive">
                                            <img src="/assets/images/product/default/home-1/default-1.jpg" alt="">
                                        </div>
                                        <div class="product-image-large-image swiper-slide img-responsive">
                                            <img src="/assets/images/product/default/home-1/default-2.jpg" alt="">
                                        </div>
                                        <div class="product-image-large-image swiper-slide img-responsive">
                                            <img src="/assets/images/product/default/home-1/default-3.jpg" alt="">
                                        </div>
                                        <div class="product-image-large-image swiper-slide img-responsive">
                                            <img src="/assets/images/product/default/home-1/default-4.jpg" alt="">
                                        </div>
                                        <div class="product-image-large-image swiper-slide img-responsive">
                                            <img src="/assets/images/product/default/home-1/default-5.jpg" alt="">
                                        </div>
                                        <div class="product-image-large-image swiper-slide img-responsive">
                                            <img src="/assets/images/product/default/home-1/default-6.jpg" alt="">
                                        </div>
                                    </div>
                                </div>
                                <!-- End Large Image -->
                                <!-- Start Thumbnail Image -->
                                <div
                                        class="product-image-thumb modal-product-image-thumb swiper-container pos-relative mt-5">
                                    <div class="swiper-wrapper">
                                        <div class="product-image-thumb-single swiper-slide">
                                            <img class="img-fluid"
                                                 src="/assets/images/product/default/home-1/default-1.jpg" alt="">
                                        </div>
                                        <div class="product-image-thumb-single swiper-slide">
                                            <img class="img-fluid"
                                                 src="/assets/images/product/default/home-1/default-2.jpg" alt="">
                                        </div>
                                        <div class="product-image-thumb-single swiper-slide">
                                            <img class="img-fluid"
                                                 src="/assets/images/product/default/home-1/default-3.jpg" alt="">
                                        </div>
                                        <div class="product-image-thumb-single swiper-slide">
                                            <img class="img-fluid"
                                                 src="/assets/images/product/default/home-1/default-4.jpg" alt="">
                                        </div>
                                        <div class="product-image-thumb-single swiper-slide">
                                            <img class="img-fluid"
                                                 src="/assets/images/product/default/home-1/default-5.jpg" alt="">
                                        </div>
                                        <div class="product-image-thumb-single swiper-slide">
                                            <img class="img-fluid"
                                                 src="/assets/images/product/default/home-1/default-6.jpg" alt="">
                                        </div>
                                    </div>
                                    <!-- Add Arrows -->
                                    <div class="gallery-thumb-arrow swiper-button-next"></div>
                                    <div class="gallery-thumb-arrow swiper-button-prev"></div>
                                </div>
                                <!-- End Thumbnail Image -->
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="modal-product-details-content-area">
                                <!-- Start  Product Details Text Area-->
                                <div class="product-details-text">
                                    <h4 class="title">Nonstick Dishwasher PFOA</h4>
                                    <div class="price">
                                        <del>$70.00</del>
                                        $80.00
                                    </div>
                                </div> <!-- End  Product Details Text Area-->
                                <!-- Start Product Variable Area -->
                                <div class="product-details-variable">
                                    <!-- Product Variable Single Item -->
                                    <div class="variable-single-item">
                                        <span>Color</span>
                                        <div class="product-variable-color">
                                            <label for="modal-product-color-red">
                                                <input name="modal-product-color" id="modal-product-color-red"
                                                       class="color-select" type="radio" checked>
                                                <span class="product-color-red"></span>
                                            </label>
                                            <label for="modal-product-color-tomato">
                                                <input name="modal-product-color" id="modal-product-color-tomato"
                                                       class="color-select" type="radio">
                                                <span class="product-color-tomato"></span>
                                            </label>
                                            <label for="modal-product-color-green">
                                                <input name="modal-product-color" id="modal-product-color-green"
                                                       class="color-select" type="radio">
                                                <span class="product-color-green"></span>
                                            </label>
                                            <label for="modal-product-color-light-green">
                                                <input name="modal-product-color"
                                                       id="modal-product-color-light-green" class="color-select"
                                                       type="radio">
                                                <span class="product-color-light-green"></span>
                                            </label>
                                            <label for="modal-product-color-blue">
                                                <input name="modal-product-color" id="modal-product-color-blue"
                                                       class="color-select" type="radio">
                                                <span class="product-color-blue"></span>
                                            </label>
                                            <label for="modal-product-color-light-blue">
                                                <input name="modal-product-color"
                                                       id="modal-product-color-light-blue" class="color-select"
                                                       type="radio">
                                                <span class="product-color-light-blue"></span>
                                            </label>
                                        </div>
                                    </div>
                                    <!-- Product Variable Single Item -->
                                    <div class="d-flex align-items-center flex-wrap">
                                        <div class="variable-single-item ">
                                            <span>Quantity</span>
                                            <div class="product-variable-quantity">
                                                <input min="1" max="100" value="1" type="number">
                                            </div>
                                        </div>

                                        <div class="product-add-to-cart-btn">
                                            <a href="#" data-bs-toggle="modal" data-bs-target="#modalAddcart">Add To
                                                Cart</a>
                                        </div>
                                    </div>
                                </div> <!-- End Product Variable Area -->
                                <div class="modal-product-about-text">
                                    <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Mollitia iste
                                        laborum ad impedit pariatur esse optio tempora sint ullam autem deleniti nam
                                        in quos qui nemo ipsum numquam, reiciendis maiores quidem aperiam, rerum vel
                                        recusandae</p>
                                </div>
                                <!-- Start  Product Details Social Area-->
                                <div class="modal-product-details-social">
                                    <span class="title">SHARE THIS PRODUCT</span>
                                    <ul>
                                        <li><a href="#" class="facebook"><i class="fa fa-facebook"></i></a></li>
                                        <li><a href="#" class="twitter"><i class="fa fa-twitter"></i></a></li>
                                        <li><a href="#" class="pinterest"><i class="fa fa-pinterest"></i></a></li>
                                        <li><a href="#" class="google-plus"><i class="fa fa-google-plus"></i></a>
                                        </li>
                                        <li><a href="#" class="linkedin"><i class="fa fa-linkedin"></i></a></li>
                                    </ul>

                                </div> <!-- End  Product Details Social Area-->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div> <!-- End Modal Quickview cart -->

<!--Modal đổi địa chỉ-->
<div class="modal fade" id="modalDoiDiaChi" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog" style="width: 1200px">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Danh sách địa chỉ</h5>
                <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">

                <div class="row mb-2">
                    <div class="col-6"></div>
                    <div class="col-6  ">
                        <!-- Thêm địa chỉ theo id tai khoản -->

                        <button th:if="${session.get('countDC') < 5}" onclick="themDiaChi();"
                                class="btn btn-primary float-right text-white " data-bs-toggle="modal"
                                data-bs-target="#modalThemDiaChi">Thêm Đ/C
                        </button>
                        <button th:unless="${session.get('countDC') < 5}" class="btn btn-primary float-right"
                                disabled>(*) Thêm Đ/C
                        </button>
                    </div>


                </div>

                <div class="row">
                    <div class="table table-wrapper-scroll-y my-custom-scrollbar" style="height: 450px">
                        <table id="table" class="table  table-borderless  formTable">
                            <thead>
                            <tr class="bg-light" style="vertical-align: middle; text-align: center;">
                                <th width="12%">Tên/SĐT</th>
                                <th width="12%">D/c cụ thể</th>
                                <th width="17%">Phường/xã</th>
                                <th width="17%">Quận/Huyện</th>
                                <th width="17%">Tỉnh/Thành Phố</th>
                                <th width="10%">Trạng thái</th>
                                <th width="19%">Thao tác</th>
                            </tr>
                            </thead>
                            <tbody id="tbodyDDC" style="vertical-align: middle; text-align: center;">


                            </tbody>
                        </table>
                    </div>
                </div>


                <div th:unless="${session.get('countDC') < 5}" class="row mt-2">
                    <h6>(*) Chỉ được thêm tối đa 5 đa địa chỉ</h6>
                </div>
            </div>

        </div>
    </div>
</div>

<div class="modal fade" id="modalThemDiaChi" tabindex="-1" data-backdrop="static"
     aria-labelledby="exampleModalLabel"
     aria-hidden="true">
    <form action="/check-out/adddc" method="post" id="formThemDiaChi">
        <div class="modal-dialog" style="width: 500px;">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Thêm địa chỉ</h5>
                    <a type="button" class="close" onclick="resetModalTDC();" data-bs-dismiss="modal"
                       aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </a>
                </div>
                <div class="modal-body">
                    <div class="container">
                        <div class="row">
                            <div class="col-6">

                                <label><span style="color: #c82333">*</span> Họ và Tên</label>
                                <input type="text" name="hoTen" id="inputTenTDC"
                                       class="form-control">
                            </div>
                            <div class="col-6">
                                <label><span style="color: #c82333">*</span> Số điện thoại</label>
                                <input type="text" name="sdt"
                                       class="form-control" id="inputSDTTDC">
                            </div>
                        </div>
                        <div class="row">
                            <label for="provincetdc"><span style="color: #c82333">*</span> Tỉnh/Thành phố</label>
                            <select id="provincetdc" name="tinh" class="form-control">
                                <option value="-1">---Chọn Tỉnh/Thành Phố----</option>
                            </select>
                        </div>

                        <div class="row">
                            <label for="districttdc"><span style="color: #c82333">*</span> Quận/Huyện</label>
                            <select name="quan" class="form-control" id="districttdc">
                                <option value="-1">---Chọn----</option>
                            </select>
                        </div>

                        <div class="row">
                            <label for="wardtdc"><span style="color: #c82333">*</span> Xã/Phường</label>
                            <select name="xa" class="form-control" id="wardtdc">
                                <option value="-1">---Chọn----</option>
                            </select>
                        </div>

                        <div class="row">
                            <label><span style="color: #c82333">*</span> Đ/C chi tiết</label>
                            <input name="dcCuThe" class="form-control" id="inputDCCTTDC" type="text">
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <!--                    ?link day nha thang ngiu-->
                    <button type="submit" id="validXacNhanThemTK" class="btn btn-primary text-white">Xác nhận</button>
                </div>
            </div>
        </div>
    </form>
</div>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"
        integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.26.1/axios.min.js"
        integrity="sha512-bPh3uwgU5qEMipS/VOmRqynnMXGGSRv+72H/N260MQeXZIK4PG48401Bsby9Nq5P5fz7hy5UGNmC/W1Z51h2GQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<script th:inline="javascript">
    const tinh = '[[${#strings.isEmpty(session.tinh) ? -1 : session.tinh}]]';
    const quan = '[[${#strings.isEmpty(session.quan) ? -1 : session.quan}]]';
    let phuong = '[[${#strings.isEmpty(session.phuong) ? -1 : session.phuong}]]';
    const tinhtinh = '[[${#strings.isEmpty(session.selectedProvince) ? "' + -1 + '" : session.selectedProvince}]]';
    console.log(tinhtinh)
    const idKh = [[${session.idkhOL}]];
    const tbodyDDC = document.getElementById('tbodyDDC');


    function loadAllDC() {
        $.ajax({
            type: 'get',
            url: 'http://localhost:8080/api/khachHang/findListDiaChi?value=' + idKh,
            success: function (data) {
                loadAllTableDC(data);
            }
        })
    }

    function loadAllTableDC(data) {
        tbodyDDC.innerHTML = '';
        for (let index = 0; index < data.length; index++) {
            loadTrDDC(data[index], index);
        }
    }


    if (document.getElementById('formThemDiaChi') != null) {
        document.getElementById('formThemDiaChi').addEventListener('submit', function (event) {

            let ten = document.getElementById('inputTenTDC').value;
            let sdt = document.getElementById('inputSDTTDC').value;
            let tinh = document.getElementById('provincetdc').value;
            let quan = document.getElementById('districttdc').value;
            let xa = document.getElementById('wardtdc').value;
            let chiTiet = document.getElementById('inputDCCTTDC').value;
            var bieuThucChu = /[a-zA-Z]/;
            var bieuThucDacBiet = /[!@#$%^&*()_+{}\[\]:;<>,.?~\\/-]/;
            if (ten.trim().length == 0 || sdt.trim().length == 0 || chiTiet.trim().length == 0 || tinh == -1 || quan == -1 || xa == -1) {
                alert("Vui lòng nhập đủ các trường đánh dấu (*)");
                event.preventDefault();

            } else if (bieuThucChu.test(sdt) || bieuThucDacBiet.test(sdt) || !sdt.startsWith('0') || (sdt.trim().length != 11 && sdt.trim().length != 10)) {
                alert("Số điện thoại gồm 10 - 11 số và bắt đầu bằng 0");
                event.preventDefault();
            } else {
                alert("Thêm thành công")
            }
        });
    }


    function apiDiaChiGender(idTinh, idQuan, idXa, tinh, quan, phuong) {
        const host = "https://provinces.open-api.vn/api/";
        let renderData = (array, select) => {
            let row = `<option  value="">--Chọn Tỉnh/Thành phố--</option>`;
            array.forEach(element => {
                if (tinh === element.code) {
                    renderDataDis(element.districts, idQuan);
                    row = `<option selected value="${element.name}">${element.name}</option>`;
                }
            });
            document.querySelector("#" + select).innerHTML = row;
        }

        let renderDataDis = (array, select) => {
            let row = `<option disable value="">--Chọn--</option>`;
            array.forEach(element => {
                if (quan === element.code) {
                    renderDataWar(element.wards, idXa);
                    row = `<option selected value="${element.name}">${element.name}</option>`;
                }
            });

            document.querySelector("#" + select).innerHTML = row;
        }

        let renderDataWar = (array, select) => {
            let row = `<option disable value="">--Chọn--</option>`;
            array.forEach(element => {
                if (phuong === element.code) {
                    row = `<option selected value="${element.name}">${element.name}</option>`;
                }
            });

            document.querySelector("#" + select).innerHTML = row;
        }

        let callAPI = (api) => {
            return axios.get(api)
                .then((response) => {
                    renderData(response.data, idTinh);
                });
        };
        callAPI('https://provinces.open-api.vn/api/?depth=3');
    }

    function themDiaChi() {
        // modalContentDDC.style.opacity = '0.6';
        const host = "https://provinces.open-api.vn/api/";
        let callAPI = (api) => {
            return axios.get(api)
                .then((response) => {
                    renderData(response.data, "provincetdc");
                });
        }
        callAPI('https://provinces.open-api.vn/api/?depth=1');
        let callApiDistrict = (api) => {
            return axios.get(api)
                .then((response) => {
                    renderData(response.data.districts, "districttdc");
                });
        }
        let callApiWard = (api) => {
            return axios.get(api)
                .then((response) => {
                    renderData(response.data.wards, "wardtdc");
                });
        }

        let renderData = (array, select) => {
            let row = ' <option disable value="">--Chọn--</option>';
            array.forEach(element => {
                row += `<option value="${element.code}">${element.name}</option>`
            });
            document.querySelector("#" + select).innerHTML = row
        }
        $("#provincetdc").change(() => {
            callApiDistrict(host + "p/" + $("#provincetdc").val() + "?depth=2");

        });
        $("#districttdc").change(() => {
            callApiWard(host + "d/" + $("#districttdc").val() + "?depth=2");

        });

    }

    function loadTrDDC(x, index) {
        let buttonChon = document.createElement('a');
        let buttonSua = document.createElement('a');
        buttonChon.href = '/check-out/updateDCMD/' + x.id;
        buttonChon.text = 'Chọn'
        buttonChon.classList.add('btn');
        buttonChon.classList.add('btn-warning');
        buttonChon.classList.add('text-white');
        buttonChon.style.display = 'inline';


        buttonSua.href = '/check-out/deleteDC/' + x.id;
        buttonSua.text = 'Xóa'
        buttonSua.classList.add('btn');
        buttonSua.classList.add('btn-danger');
        buttonSua.classList.add('mx-1');
        buttonSua.classList.add('text-white');
        buttonSua.style.display = 'inline';
        buttonSua.addEventListener("click", function (event) {
            let x = confirm("Bạn chắc chắn muốn xóa");
            if (!x) {
                event.preventDefault();
            }
        })

        let row = tbodyDDC.insertRow();
        let idHTML = index + 1;
        let selectTinh = '<select disabled id="province' + idHTML + '" class="text-center" style="border: 0px;appearance: none;"></select>'
        let selectQuan = '<select disabled id="district' + idHTML + '" class="text-center" style="border: 0px;appearance: none;"></select>'
        let selectXa = '<select disabled id="ward' + idHTML + '" class="text-center" style="border: 0px;appearance: none;"></select>'
        let checkBox = '';

        if (x.diaChiMacDinh == 1) {
            checkBox = '<button style="font-size: 10px" class="btn btn-success text-white">Mặc định</button>';
        }
        row.insertCell().innerHTML = x.ten + '<br>' + x.sdt;
        row.insertCell().innerHTML = x.diaChiCuThe;
        row.insertCell().innerHTML = selectXa;
        row.insertCell().innerHTML = selectQuan;
        row.insertCell().innerHTML = selectTinh;
        row.insertCell().innerHTML = checkBox;
        let action = row.insertCell();

        if (x.diaChiMacDinh != 1) {
            action.appendChild(buttonChon);
            action.appendChild(buttonSua);
        }
        apiDiaChiGender('province' + idHTML, 'district' + idHTML, 'ward' + idHTML, x.tinh, x.quanHuyen, x.phuongXa);
    }

    const host = "https://provinces.open-api.vn/api/";

    const renderOptions = (array, selectId, placeholder) => {
        let options = '';
        // Add placeholder regardless of whether the array is empty
        options += `<option disable value="">${placeholder}</option>`;
        array.forEach(element => {
            options += `<option value="${element.code}">${element.name}</option>`;
        });
        document.querySelector("#" + selectId).innerHTML = options;
    };

    const callAPI = (api, selectId, renderFunction) => {
        return axios.get(api)
            .then((response) => {
                renderFunction(response.data, selectId);
            })
            .catch((error) => {
                console.error(error);
            });
    };
    // const tinhtinh = '[[${#strings.isEmpty(session.selectedProvince) ? "' + selectedProvinceCode + '" : session.selectedProvince}]]';
    let initialTotalAmount;

    // Lấy giá trị tổng tiền ban đầu khi trang web được tải lần đầu
    initialTotalAmount = parseFloat($("#totalAmount").data("id"));

    // Hàm cập nhật tổng tiền
    function updateTotalAmount(newTotal, shippingFee) {
        const totalAmountWithShipping = newTotal + shippingFee;
        var formattedAmount = new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(totalAmountWithShipping);

        $("#totalAmount").text(`${formattedAmount}`);
        var shippingFee3 = new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(shippingFee);
        $("#shipping-cost").text(`${shippingFee3}`);
    }

    function updateShippingFee(selectedProvinceCode) {
        if (!selectedProvinceCode) {
            $("#shipping-cost").text("Vui lòng chọn địa chỉ");
            return 0;
        } else {
            $("#shipping-cost").text("");
            var shippingFee = 0;
            if(initialTotalAmount < 2000000){
                shippingFee = selectedProvinceCode === "1" ? 20000 : 30000;
            }
            var formattedAmount = new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(shippingFee);

            $("#shipping-cost").text(formattedAmount);

            $("#feeShipped").val(shippingFee);

            return shippingFee;
        }
    }

    $("#province").change(() => {
        const selectedProvinceCode = $("#province").val();

        const shippingFee = updateShippingFee(selectedProvinceCode);

        updateTotalAmount(initialTotalAmount, shippingFee);

        console.log("Initial Total:", $("#totalAmount").text());

        callAPI(host + "p/" + selectedProvinceCode + "?depth=2", "district", (data, selectId) => {
            renderOptions(data.districts, selectId, "--Chọn Quận/Huyện--");
        });

        callAPI(host + "d/" + $("#district").val() + "?depth=2", "ward", (data, selectId) => {
            renderOptions(data.wards, selectId, "--Chọn Phường/Xã--");
        });

        printResult();
    });

    $("#district").change(() => {
        callAPI(host + "d/" + $("#district").val() + "?depth=2", "ward", (data, selectId) => {
            renderOptions(data.wards, selectId, "--Chọn Phường/Xã--");
        });

        printResult();
    });

    updateTotalAmount(initialTotalAmount, calculateShippingFee());

    function calculateShippingFee() {
        var selectedProvince = '[[${session.selectedProvince}]]';
        var shippingFee = 0;
        if(initialTotalAmount < 2000000){
            shippingFee = selectedProvince === "1" ? 20000 : 30000;
        }
        return shippingFee;
    }


    $("#ward").change(() => {
        printResult();
    });
    const printResult = () => {
        if ($("#district").val() !== "" && $("#province").val() !== "" && $("#ward").val() !== "") {
            let result = $("#province option:selected").text() +
                " | " + $("#district option:selected").text() + " | " +
                $("#ward option:selected").text();
            $("#result").text(result);
        }
    };

    callAPI(host + "?depth=2", "province", (data, selectId) => {
        renderOptions(data, selectId, "--Chọn Tỉnh/Thành phố--");
        renderOptions([], "district", "--Chọn Quận/Huyện--");
        renderOptions([], "ward", "--Chọn Phường/Xã--");
    });

    if (tinh !== "-1") {
        callAPI(host + "?depth=3", "province", (data, selectId) => {
            renderOptions(data, selectId, "--Chọn Tỉnh/Thành phố--");

            $("#province").val(tinh);

            callAPI(host + "p/" + tinh + "?depth=2", "district", (districtData, districtSelectId) => {
                renderOptions(districtData.districts, districtSelectId, "--Chọn Quận/Huyện--");

                $("#district").val(quan);

                callAPI(host + "d/" + quan + "?depth=2", "ward", (wardData, wardSelectId) => {
                    renderOptions(wardData.wards, wardSelectId, "--Chọn Phường/Xã--");

                    $("#ward").val(phuong);
                    printResult();
                });
            });
        });
    } else {
        renderOptions([], "district", "--Chọn Quận/Huyện--");
        renderOptions([], "ward", "--Chọn Phường/Xã--");


        if (myLinksXNTC != null) {
            myLinksXNTC.addEventListener('click', function (event) {
                event.preventDefault();
                let mess = prompt("Nhập ghi chú : ");
                let action = actionFormXNTC.getAttribute('action') + '?value=' + mess;

                actionFormXNTC.submit();
            });
        }

    }


    document.getElementById("btnThanhToan").addEventListener("click", function (event) {
        event.preventDefault();

        const formThanhToan = document.getElementById("formThanhToan");
        var paymentMethod = document.querySelector('input[name="hinhThucThanhToan"]:checked').id;

        if (paymentMethod === "currencyCod") {
            let selectTinh = document.getElementById('province');
            let selectHuyen = document.getElementById('district');
            let selectXa = document.getElementById('ward');
            let tinh = selectTinh.options[selectTinh.selectedIndex].textContent;
            let huyen = selectHuyen.options[selectHuyen.selectedIndex].textContent;
            let xa = selectXa.options[selectXa.selectedIndex].textContent;

            let action = formThanhToan.getAttribute('action') + '?thanhPho=' + tinh + '&' + 'huyen=' + huyen + '&' + 'xa=' + xa;
            console.log(action);
            formThanhToan.setAttribute('action', action);
            formThanhToan.submit();
        } else {
            event.preventDefault();

            let selectTinh = document.getElementById('province');
            let selectHuyen = document.getElementById('district');
            let selectXa = document.getElementById('ward');
            let tinh = selectTinh.options[selectTinh.selectedIndex].textContent;
            let huyen = selectHuyen.options[selectHuyen.selectedIndex].textContent;
            let xa = selectXa.options[selectXa.selectedIndex].textContent;

            let action = formThanhToan.getAttribute('action') + '?thanhPho=' + tinh + '&' + 'huyen=' + huyen + '&' + 'xa=' + xa;
            console.log(action);
            formThanhToan.setAttribute('action', action);
            formThanhToan.submit();
            let tenn = document.getElementById('nameTen').value;
            let sdtn = document.getElementById('nameSoDienThoai').value;
            let tinhh = document.getElementById('province').value;
            let quanHuyenn = document.getElementById('district').value;
            let phuongXan = document.getElementById('ward').value;
            let diaChiCuThen = document.getElementById('nameDiaChiCuThe').value;
            if (
                tenn != null && tenn.trim() !== '' &&
                sdtn != null && sdtn.trim() !== '' &&
                tinhh != null && tinhh.trim() !== '' &&
                quanHuyenn != null && quanHuyenn.trim() !== '' &&
                phuongXan != null && phuongXan.trim() !== '' &&
                diaChiCuThen != null && diaChiCuThen.trim() !== ''

            ) {
                fetch("/api/payment/create_payment?totalAmount=" + encodeURIComponent(document.getElementById("totalAmount").innerText))
                    .then(response => response.text())
                    .then(paymentUrl => {
                        console.log("Received Payment URL:", paymentUrl);
                        document.getElementById("formThanhToan").action = paymentUrl;
                        formThanhToan.submit();

                    }).catch(error => {
                    console.error("Error fetching payment URL:", error);
                });
            }
        }

    });

    function handlePaymentButtonClick() {
        console.log("Button clicked");
        var selectedRadioButton = document.querySelector('input[name="hinhThucThanhToan"]:checked');

        if (selectedRadioButton === null) {
            console.log("No radio button selected");
            let type = 'error';
            let icon = 'fa-solid fa-circle-exclamation';
            let title = 'Chưa chọn hình thức!';
            let text = "Bạn chưa chọn hình thức thanh toán!";
            createToast(type, icon, title, text);
        }
    }




</script>
</body>


</html>