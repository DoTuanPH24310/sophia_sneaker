<!DOCTYPE html>
<html lang="html" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{/website/layout/layout}">
<meta http-equiv="content-type" content="text/html;charset=UTF-8"/><!-- /Added by HTTrack -->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

    <style>
        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 200%;
            background: rgba(255, 255, 255, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        .loading-spinner {
            border: 8px solid #f3f3f3;
            border-top: 8px solid #3498db;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }
    </style>
</head>

<body layout:fragment="content2">
<!--  Start Offcanvas Mobile Menu Section -->
<div id="mobile-menu-offcanvas" class="offcanvas offcanvas-rightside offcanvas-mobile-menu-section">
    <!-- Start Offcanvas Header -->
    <div class="offcanvas-header text-right">
        <button class="offcanvas-close"><i class="ion-android-close"></i></button>
    </div> <!-- End Offcanvas Header -->
    <!-- Start Offcanvas Mobile Menu Wrapper -->
    <div class="offcanvas-mobile-menu-wrapper">
        <!-- Start Mobile Menu  -->
        <div class="mobile-menu-bottom">
            <!-- Start Mobile Menu Nav -->
            <div class="offcanvas-menu">
                <ul>
                    <li>
                        <a class="main-menu-link" th:href="@{/sophia-store/home}">Trang chủ </a>
                    </li>
                    <li class="has-megaitem">
                        <a th:href="@{/sophia-store/product}">Sản phẩm </a>
                    </li>
                    <li>
                        <a th:href="@{/sophia-store/chung-toi}">Về chúng tôi</a>
                    </li>
                    <li>
                        <a th:href="@{/sophia-store/lien-he}">Liên hệ</a>
                    </li>
                    <li>
                        <a th:href="@{/sophia-store/FAQS}">FAQS</a>
                    </li>
                </ul>
            </div>
        </div>


    </div>
</div>
<!-- Start Offcanvas Mobile Menu Section -->
<div id="offcanvas-about" class="offcanvas offcanvas-rightside offcanvas-mobile-about-section">
    <!-- Start Offcanvas Header -->
    <div class="offcanvas-header text-right">
        <button class="offcanvas-close"><i class="ion-android-close"></i></button>
    </div> <!-- End Offcanvas Header -->
    <!-- Start Offcanvas Mobile Menu Wrapper -->
    <!-- Start Mobile contact Info -->
    <div class="mobile-contact-info">
        <div class="logo">
            <a href="../websiteShop/index.html"><img src="/assets/images/logo/logo_white.png" alt=""></a>
        </div>

        <address class="address">
            <span>Address: Your address goes here.</span>
            <span>Call Us: 0123456789, 0123456789</span>
            <span>Email: demo@example.com</span>
        </address>

        <ul class="social-link">
            <li><a href="#"><i class="fa fa-facebook"></i></a></li>
            <li><a href="#"><i class="fa fa-twitter"></i></a></li>
            <li><a href="#"><i class="fa fa-instagram"></i></a></li>
            <li><a href="#"><i class="fa fa-linkedin"></i></a></li>
        </ul>

        <ul class="user-link">
            <li><a href="../wishlist.html">Wishlist</a></li>
            <li><a href="../cart.html">Cart</a></li>
            <li><a href="checkout.html">Checkout</a></li>
        </ul>
    </div>
    <!-- End Mobile contact Info -->
</div> <!-- ...:::: End Offcanvas Mobile Menu Section:::... -->

<!-- Start Offcanvas Addcart Section -->
<div id="offcanvas-add-cart" class="offcanvas offcanvas-rightside offcanvas-add-cart-section">
    <!-- Start Offcanvas Header -->
    <div class="offcanvas-header text-right">
        <button class="offcanvas-close"><i class="ion-android-close"></i></button>
    </div> <!-- End Offcanvas Header -->

    <!-- Start  Offcanvas Addcart Wrapper -->
    <div class="offcanvas-add-cart-wrapper">
        <h4 class="offcanvas-title">Giỏ hàng</h4>
        <ul class="offcanvas-cart">
            <li class="offcanvas-cart-item-single" th:each="item : ${cartItem}">
                <div class="offcanvas-cart-item-block">
                    <a href="#" class="offcanvas-cart-item-image-link">
                        <img class="offcanvas-cart-image" th:src="@{${item.anh}}" style="width: 92px; height: 92px"
                             alt="">
                    </a>
                    <div class="offcanvas-cart-item-content">
                        <a href="#" class="offcanvas-cart-item-link"
                           th:text="${item.hang + ' ' + item.giay + ' ' + item.loaiGiay + ' ' + item.mauSac}"></a>
                        <div class="offcanvas-cart-item-details">
                            <span class="offcanvas-cart-item-details-quantity" th:text="${item.soLuong} + ' x'"></span>
                            <span class="offcanvas-cart-item-details-price"
                                  th:text="${#numbers.formatCurrency(item.gia)}"></span>
                        </div>
                    </div>
                </div>
                <div class="offcanvas-cart-item-delete text-right">
                    <a href="#" class="offcanvas-cart-item-delete"><i class="fa fa-trash-o"></i></a>
                </div>
            </li>

        </ul>
        <div class="offcanvas-cart-total-price">
            <span class="offcanvas-cart-total-price-text">Subtotal:</span>
            <span class="offcanvas-cart-total-price-value" th:text="${#numbers.formatCurrency(totalCartPrice)}"></span>
        </div>
        <ul class="offcanvas-cart-action-button">
            <li><a th:href="@{/cart/hien-thi}" class="btn btn-block btn-golden">Giỏ hàng</a></li>
            <li><a href="compare.html" class=" btn btn-block btn-golden mt-5">Checkout</a></li>
        </ul>
    </div> <!-- End  Offcanvas Addcart Wrapper -->

</div>
<!-- Start Offcanvas Mobile Menu Section -->
<div id="offcanvas-wishlish" class="offcanvas offcanvas-rightside offcanvas-add-cart-section">
    <!-- Start Offcanvas Header -->
    <div class="offcanvas-header text-right">
        <button class="offcanvas-close"><i class="ion-android-close"></i></button>
    </div> <!-- ENd Offcanvas Header -->

    <!-- Start Offcanvas Mobile Menu Wrapper -->
    <div class="offcanvas-wishlist-wrapper">
        <h4 class="offcanvas-title">Wishlist</h4>
        <ul class="offcanvas-wishlist">
            <li class="offcanvas-wishlist-item-single">
                <div class="offcanvas-wishlist-item-block">
                    <a href="#" class="offcanvas-wishlist-item-image-link">
                        <img src="/assets/images/product/default/home-1/default-1.jpg" alt=""
                             class="offcanvas-wishlist-image">
                    </a>
                    <div class="offcanvas-wishlist-item-content">
                        <a href="#" class="offcanvas-wishlist-item-link">Car Wheel</a>
                        <div class="offcanvas-wishlist-item-details">
                            <span class="offcanvas-wishlist-item-details-quantity">1 x </span>
                            <span class="offcanvas-wishlist-item-details-price">$49.00</span>
                        </div>
                    </div>
                </div>
                <div class="offcanvas-wishlist-item-delete text-right">
                    <a href="#" class="offcanvas-wishlist-item-delete"><i class="fa fa-trash-o"></i></a>
                </div>
            </li>
            <li class="offcanvas-wishlist-item-single">
                <div class="offcanvas-wishlist-item-block">
                    <a href="#" class="offcanvas-wishlist-item-image-link">
                        <img src="/assets/images/product/default/home-2/default-1.jpg" alt=""
                             class="offcanvas-wishlist-image">
                    </a>
                    <div class="offcanvas-wishlist-item-content">
                        <a href="#" class="offcanvas-wishlist-item-link">Car Vails</a>
                        <div class="offcanvas-wishlist-item-details">
                            <span class="offcanvas-wishlist-item-details-quantity">3 x </span>
                            <span class="offcanvas-wishlist-item-details-price">$500.00</span>
                        </div>
                    </div>
                </div>
                <div class="offcanvas-wishlist-item-delete text-right">
                    <a href="#" class="offcanvas-wishlist-item-delete"><i class="fa fa-trash-o"></i></a>
                </div>
            </li>
            <li class="offcanvas-wishlist-item-single">
                <div class="offcanvas-wishlist-item-block">
                    <a href="#" class="offcanvas-wishlist-item-image-link">
                        <img src="/assets/images/product/default/home-3/default-1.jpg" alt=""
                             class="offcanvas-wishlist-image">
                    </a>
                    <div class="offcanvas-wishlist-item-content">
                        <a href="#" class="offcanvas-wishlist-item-link">Shock Absorber</a>
                        <div class="offcanvas-wishlist-item-details">
                            <span class="offcanvas-wishlist-item-details-quantity">1 x </span>
                            <span class="offcanvas-wishlist-item-details-price">$350.00</span>
                        </div>
                    </div>
                </div>
                <div class="offcanvas-wishlist-item-delete text-right">
                    <a href="#" class="offcanvas-wishlist-item-delete"><i class="fa fa-trash-o"></i></a>
                </div>
            </li>
        </ul>
        <ul class="offcanvas-wishlist-action-button">
            <li><a href="#" class="btn btn-block btn-golden">View wishlist</a></li>
        </ul>
    </div> <!-- End Offcanvas Mobile Menu Wrapper -->

</div> <!-- End Offcanvas Mobile Menu Section -->

<!-- Start Offcanvas Search Bar Section -->
<div id="search" class="search-modal">
    <button type="button" class="close">×</button>
    <form>
        <input type="search" placeholder="type keyword(s) here"/>
        <button type="submit" class="btn btn-lg btn-golden">Search</button>
    </form>
</div>
<!-- End Offcanvas Search Bar Section -->

<!-- Offcanvas Overlay -->
<div class="offcanvas-overlay"></div>

<!-- ...:::: Start Breadcrumb Section:::... -->
<div class="breadcrumb-section breadcrumb-bg-color--golden">
    <div class="breadcrumb-wrapper">
        <div class="container">
            <div class="row">
                <div class="col-12">
                    <h3 class="breadcrumb-title">Checkout</h3>
                    <div class="breadcrumb-nav breadcrumb-nav-color--black breadcrumb-nav-hover-color--golden">
                        <nav aria-label="breadcrumb">
                            <ul>
                                <li><a href="../websiteShop/index.html">Home</a></li>
                                <li><a href="../shop-grid-sidebar-left.html">Shop</a></li>
                                <li class="active" aria-current="page">Checkout</li>
                            </ul>
                        </nav>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div> <!-- ...:::: End Breadcrumb Section:::... -->

<!-- ...:::: Start Checkout Section:::... -->
<div class="checkout-section">
    <div class="container">

        <!-- Start User Details Checkout Form -->
        <form th:object="${diaChi}" method="post" th:action="@{/check-out/thanhtoan}" id="formThanhToan">

            <div class="checkout_form" data-aos="fade-up" data-aos-delay="400">
                <div class="row">
                    <div class="col-lg-6 col-md-6">
                        <h3>Thông tin địa chỉ</h3>
                        <div class="row">
                            <div class="col-12">
                                <div class="default-form-box">
                                    <label>Họ tên người nhận hàng<span>*</span></label>
                                    <input type="text" th:field="*{ten}" id="nameTen">
                                    <span th:errors="*{ten}" style="color: red"></span>
                                </div>
                            </div>
                            <div class="col-lg-6">
                                <div class="default-form-box">
                                    <label>Số điện thoại <span>*</span></label>
                                    <input type="text" th:field="*{sdt}" id="nameSoDienThoai">
                                    <span th:errors="*{sdt}" style="color: red"></span>
                                </div>
                            </div>
                            <div class="col-lg-6">
                                <div class="default-form-box">
                                    <label> Địa chỉ email <span>*</span></label>
                                    <input type="text" th:field="*{email}" id="nameEmail">
                                    <span th:if="${#fields.hasErrors('email')}" th:errors="*{email}"
                                          style="color: red"></span>
                                </div>
                            </div>
                            <div class="col-4">
                                <div class="default-form-box">
                                    <label for="province">Tỉnh<span>*</span></label>
                                    <select class="country_option nice-select wide" id="province"
                                            th:field="*{tinh}" placeholder="Chọn tỉnh">
                                        <option value="">Chọn tỉnh</option>
                                        <option value=""></option>

                                    </select>
                                    <span th:errors="*{tinh}" style="color: red"></span>
                                </div>
                            </div>
                            <div class="col-4">
                                <div class="default-form-box">
                                    <label for="district">Huyện <span>*</span></label>
                                    <select class="country_option nice-select wide" id="district"
                                            th:field="*{quanHuyen}" placeholder="Chọn huyện">
                                        <option value="">Chọn quận huyện</option>
                                        <option value=""></option>
                                    </select>
                                    <span th:errors="*{quanHuyen}" style="color: red"></span>
                                </div>
                            </div>
                            <div class="col-4">
                                <div class="default-form-box">
                                    <label for="ward">Xã <span>*</span></label>
                                    <select class="country_option nice-select wide" id="ward"
                                            th:field="*{phuongXa}" placeholder="Chọn xã">
                                        <option value="">Chọn phường xã</option>
                                        <option value=""></option>
                                    </select>
                                    <span th:errors="*{phuongXa}" style="color: red"></span>
                                </div>
                            </div>


                            <div class="col-12">
                                <div class="default-form-box">
                                    <label>Địa chỉ cụ thể <span>*</span></label>
                                    <input placeholder="House number and street name" type="text"
                                           th:field="*{diaChiCuThe}" id="nameDiaChiCuThe">
                                    <span th:errors="*{diaChiCuThe}" style="color: red"></span>
                                </div>
                            </div>
                            <div class="col-12">
                                <div class="default-form-box">
                                    <label for="ghiChu">Ghi chú</label>
                                    <textarea id="ghiChu" name="ghiChu" style="height: 100px;"></textarea>
                                    <span th:if="${#fields.hasErrors('ghiChu')}" th:errors="*{ghiChu}"
                                          style="color: red"></span>
                                </div>
                            </div>
                            <div class="col-12">
                                <label class="checkbox-default">
                                    <input type="radio" name="giaoHang" checked>
                                    <span class="font-weight-bold">Giao hàng tiêu chuẩn</span>
                                    <br>
                                    <br>
                                    <span class="d-block mb-3">Miễn phí vận chuyển đối với đơn hàng từ 2.000.000đ.</span>
                                    <span class="d-block mb-3">Giao tại Hà Nội 20.000đ.</span>
                                    <span class="d-block">Các địa chỉ khác: 30.000đ</span>
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-6 col-md-6">
                        <form th:action="@{/check-out/thanhtoan}" method="post">
                            <h3>Đơn hàng của bạn</h3>
                            <div class="order_table table-responsive">
                                <table>
                                    <thead>
                                    <tr>
                                        <th>Ảnh</th>
                                        <th>Sản phẩm</th>
                                        <th>Số lượng</th>
                                        <th>Đơn giá</th>
                                        <th>Thành tiền</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr th:each="item : ${cartItems}" style="max-height: 150px; overflow-y: auto;">
                                        <td class="product_thumb">
                                            <img class="offcanvas-cart-image" th:src="@{${item.anh}}"
                                                 style="width: 92px; height: 92px" alt="">
                                        </td>
                                        <td>
                                            <p th:text="${item.hang + ' ' + item.giay + ' ' + item.loaiGiay + ' ' + item.mauSac + '  [' + item.kichCo + ']'}"></p>
                                        </td>
                                        <td>
                                            <p th:text="${item.soLuong}"></p>
                                        </td>
                                        <td>
                                            <span th:if="${session['giaCu_' + item.id] != session['giaMoi_' + item.id]}"
                                                  class="original-price"
                                                  style="text-decoration: line-through; color: red; font-size: 13px"
                                                  th:text="${#numbers.formatCurrency(session['giaCu_' + item.id])}"></span>
                                            <br>
                                            <span class="discounted-price"
                                                  th:if="${session['giaCu_' + item.id] != session['giaMoi_' + item.id]}"
                                                  th:text="${#numbers.formatCurrency(session['giaMoi_' + item.id])}"></span>

                                            <span th:unless="${session['giaCu_' + item.id] != session['giaMoi_' + item.id]}"
                                                  th:text="${#numbers.formatCurrency(session['giaCu_' + item.id])}"></span>
                                        </td>
                                        <td>
                                            <p th:text="${#numbers.formatCurrency(session['giaMoi_' + item.id] * item.soLuong)}"></p>
                                        </td>
                                    </tr>
                                    </tbody>
                                    <tfoot>
                                    <tr>
                                        <td colspan="4" style="text-align: center;">Tổng giá sản phẩm</td>
                                        <td th:text="${#numbers.formatCurrency(total)}"></td>
                                    </tr>
                                    <tr>
                                        <td colspan="4" style="text-align: center;">Phí vận chuyển</td>
                                        <td id="shipping-cost" name="shipping">Vui Lòng chọn địa chỉ</td>
                                    </tr>
                                    <tr class="order_total">
                                        <td colspan="4" style="text-align: center;">Tổng tiền đơn hàng</td>
                                        <td><strong id="totalAmount" th:data-id="${total}"
                                                    th:text="${#numbers.formatCurrency(total)}"></strong>
                                        </td>
                                    </tr>
                                    </tfoot>
                                </table>

                            </div>
                            <div class="payment_method">
                                <div class="panel-default">
                                    <label class="checkbox-default" for="currencyCod" data-bs-toggle="collapse"
                                           data-bs-target="#methodCod">
                                        <input type="radio" id="currencyCod" name="hinhThucThanhToan" value="3" checked>
                                        <span>Thanh toán khi nhận hàng</span>
                                    </label>

                                    <div id="methodCod" class="collapse" data-parent="#methodCod">
                                        <div class="card-body1">
                                            <p>Thanh toán bằng tiền mặt khi nhận hàng tại địa chỉ bạn chỉ định.</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="panel-default">
                                    <label class="checkbox-default" for="currencyPaypal" data-bs-toggle="collapse"
                                           data-bs-target="#methodPaypal">
                                        <input type="radio" id="currencyPaypal" name="hinhThucThanhToan" value="2">
                                        <span>VNPay</span>
                                    </label>
                                    <div id="methodPaypal" class="collapse " data-parent="#methodPaypal">
                                        <div class="card-body1">
                                            <p>Thanh toán qua VNPay - tiện lợi và an toàn với thẻ tín dụng hoặc thẻ ghi
                                                nợ từ ngân hàng.</p>
                                        </div>
                                    </div>
                                </div>

                            </div>
                        </form>
                        <div class="order_button pt-3">
                            <button id="btnThanhToan" class="btn btn-md btn-black-default-hover" type="submit">Thanh
                                toán
                            </button>
                        </div>
                    </div>
                </div>
            </div> <!-- Start User Details Checkout Form -->
        </form>

    </div>
</div><!-- ...:::: End Checkout Section:::... -->

<!-- material-scrolltop button -->
<button class="material-scrolltop" type="button"></button>

<!-- Start Modal Add cart -->
<div class="modal fade" id="modalAddcart" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog  modal-dialog-centered modal-xl" role="document">
        <div class="modal-content">
            <div class="modal-body">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col text-right">
                            <button type="button" class="close modal-close" data-bs-dismiss="modal"
                                    aria-label="Close">
                                <span aria-hidden="true"> <i class="fa fa-times"></i></span>
                            </button>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-7">
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="modal-add-cart-product-img">
                                        <img class="img-fluid"
                                             src="/assets/images/product/default/home-1/default-1.jpg" alt="">
                                    </div>
                                </div>
                                <div class="col-md-8">
                                    <div class="modal-add-cart-info"><i class="fa fa-check-square"></i>Added to cart
                                        successfully!
                                    </div>
                                    <div class="modal-add-cart-product-cart-buttons">
                                        <a href="../cart.html">View Cart</a>
                                        <a href="checkout.html">Checkout</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-5 modal-border">
                            <ul class="modal-add-cart-product-shipping-info">
                                <li><strong><i class="icon-shopping-cart"></i> There Are 5 Items In Your
                                    Cart.</strong></li>
                                <li><strong>TOTAL PRICE: </strong> <span>$187.00</span></li>
                                <li class="modal-continue-button"><a href="#" data-bs-dismiss="modal">CONTINUE
                                    SHOPPING</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div> <!-- End Modal Add cart -->

<!-- Start Modal Quickview cart -->
<div class="modal fade" id="modalQuickview" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog  modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-body">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col text-right">
                            <button type="button" class="close modal-close" data-bs-dismiss="modal"
                                    aria-label="Close">
                                <span aria-hidden="true"> <i class="fa fa-times"></i></span>
                            </button>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="product-details-gallery-area mb-7">
                                <!-- Start Large Image -->
                                <div class="product-large-image modal-product-image-large swiper-container">
                                    <div class="swiper-wrapper">
                                        <div class="product-image-large-image swiper-slide img-responsive">
                                            <img src="/assets/images/product/default/home-1/default-1.jpg" alt="">
                                        </div>
                                        <div class="product-image-large-image swiper-slide img-responsive">
                                            <img src="/assets/images/product/default/home-1/default-2.jpg" alt="">
                                        </div>
                                        <div class="product-image-large-image swiper-slide img-responsive">
                                            <img src="/assets/images/product/default/home-1/default-3.jpg" alt="">
                                        </div>
                                        <div class="product-image-large-image swiper-slide img-responsive">
                                            <img src="/assets/images/product/default/home-1/default-4.jpg" alt="">
                                        </div>
                                        <div class="product-image-large-image swiper-slide img-responsive">
                                            <img src="/assets/images/product/default/home-1/default-5.jpg" alt="">
                                        </div>
                                        <div class="product-image-large-image swiper-slide img-responsive">
                                            <img src="/assets/images/product/default/home-1/default-6.jpg" alt="">
                                        </div>
                                    </div>
                                </div>
                                <!-- End Large Image -->
                                <!-- Start Thumbnail Image -->
                                <div
                                        class="product-image-thumb modal-product-image-thumb swiper-container pos-relative mt-5">
                                    <div class="swiper-wrapper">
                                        <div class="product-image-thumb-single swiper-slide">
                                            <img class="img-fluid"
                                                 src="/assets/images/product/default/home-1/default-1.jpg" alt="">
                                        </div>
                                        <div class="product-image-thumb-single swiper-slide">
                                            <img class="img-fluid"
                                                 src="/assets/images/product/default/home-1/default-2.jpg" alt="">
                                        </div>
                                        <div class="product-image-thumb-single swiper-slide">
                                            <img class="img-fluid"
                                                 src="/assets/images/product/default/home-1/default-3.jpg" alt="">
                                        </div>
                                        <div class="product-image-thumb-single swiper-slide">
                                            <img class="img-fluid"
                                                 src="/assets/images/product/default/home-1/default-4.jpg" alt="">
                                        </div>
                                        <div class="product-image-thumb-single swiper-slide">
                                            <img class="img-fluid"
                                                 src="/assets/images/product/default/home-1/default-5.jpg" alt="">
                                        </div>
                                        <div class="product-image-thumb-single swiper-slide">
                                            <img class="img-fluid"
                                                 src="/assets/images/product/default/home-1/default-6.jpg" alt="">
                                        </div>
                                    </div>
                                    <!-- Add Arrows -->
                                    <div class="gallery-thumb-arrow swiper-button-next"></div>
                                    <div class="gallery-thumb-arrow swiper-button-prev"></div>
                                </div>
                                <!-- End Thumbnail Image -->
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="modal-product-details-content-area">
                                <!-- Start  Product Details Text Area-->
                                <div class="product-details-text">
                                    <h4 class="title">Nonstick Dishwasher PFOA</h4>
                                    <div class="price">
                                        <del>$70.00</del>
                                        $80.00
                                    </div>
                                </div> <!-- End  Product Details Text Area-->
                                <!-- Start Product Variable Area -->
                                <div class="product-details-variable">
                                    <!-- Product Variable Single Item -->
                                    <div class="variable-single-item">
                                        <span>Color</span>
                                        <div class="product-variable-color">
                                            <label for="modal-product-color-red">
                                                <input name="modal-product-color" id="modal-product-color-red"
                                                       class="color-select" type="radio" checked>
                                                <span class="product-color-red"></span>
                                            </label>
                                            <label for="modal-product-color-tomato">
                                                <input name="modal-product-color" id="modal-product-color-tomato"
                                                       class="color-select" type="radio">
                                                <span class="product-color-tomato"></span>
                                            </label>
                                            <label for="modal-product-color-green">
                                                <input name="modal-product-color" id="modal-product-color-green"
                                                       class="color-select" type="radio">
                                                <span class="product-color-green"></span>
                                            </label>
                                            <label for="modal-product-color-light-green">
                                                <input name="modal-product-color"
                                                       id="modal-product-color-light-green" class="color-select"
                                                       type="radio">
                                                <span class="product-color-light-green"></span>
                                            </label>
                                            <label for="modal-product-color-blue">
                                                <input name="modal-product-color" id="modal-product-color-blue"
                                                       class="color-select" type="radio">
                                                <span class="product-color-blue"></span>
                                            </label>
                                            <label for="modal-product-color-light-blue">
                                                <input name="modal-product-color"
                                                       id="modal-product-color-light-blue" class="color-select"
                                                       type="radio">
                                                <span class="product-color-light-blue"></span>
                                            </label>
                                        </div>
                                    </div>
                                    <!-- Product Variable Single Item -->
                                    <div class="d-flex align-items-center flex-wrap">
                                        <div class="variable-single-item ">
                                            <span>Quantity</span>
                                            <div class="product-variable-quantity">
                                                <input min="1" max="100" value="1" type="number">
                                            </div>
                                        </div>

                                        <div class="product-add-to-cart-btn">
                                            <a href="#" data-bs-toggle="modal" data-bs-target="#modalAddcart">Add To
                                                Cart</a>
                                        </div>
                                    </div>
                                </div> <!-- End Product Variable Area -->
                                <div class="modal-product-about-text">
                                    <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Mollitia iste
                                        laborum ad impedit pariatur esse optio tempora sint ullam autem deleniti nam
                                        in quos qui nemo ipsum numquam, reiciendis maiores quidem aperiam, rerum vel
                                        recusandae</p>
                                </div>
                                <!-- Start  Product Details Social Area-->
                                <div class="modal-product-details-social">
                                    <span class="title">SHARE THIS PRODUCT</span>
                                    <ul>
                                        <li><a href="#" class="facebook"><i class="fa fa-facebook"></i></a></li>
                                        <li><a href="#" class="twitter"><i class="fa fa-twitter"></i></a></li>
                                        <li><a href="#" class="pinterest"><i class="fa fa-pinterest"></i></a></li>
                                        <li><a href="#" class="google-plus"><i class="fa fa-google-plus"></i></a>
                                        </li>
                                        <li><a href="#" class="linkedin"><i class="fa fa-linkedin"></i></a></li>
                                    </ul>

                                </div> <!-- End  Product Details Social Area-->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div> <!-- End Modal Quickview cart -->

<script src="/assets/js/vendor/vendor.min.js"></script>
<script src="/assets/js/plugins/plugins.min.js"></script>
<!-- Main JS -->
<script src="/assets/js/main.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"
        integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.26.1/axios.min.js"
        integrity="sha512-bPh3uwgU5qEMipS/VOmRqynnMXGGSRv+72H/N260MQeXZIK4PG48401Bsby9Nq5P5fz7hy5UGNmC/W1Z51h2GQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script>
    const tinh = [[${#strings.isEmpty(session.tinh) ? -1 : session.tinh}]];
    const quan = [[${#strings.isEmpty(session.quan) ? -1 : session.quan}]];
    let phuong = [[${#strings.isEmpty(session.phuong) ? -1 : session.phuong}]];

    const host = "https://provinces.open-api.vn/api/";

    const renderOptions = (array, selectId, placeholder) => {
        let options = '';
        // Add placeholder regardless of whether the array is empty
        options += `<option disable value="">${placeholder}</option>`;
        array.forEach(element => {
            options += `<option value="${element.code}">${element.name}</option>`;
        });
        document.querySelector("#" + selectId).innerHTML = options;
    };


    const callAPI = (api, selectId, renderFunction) => {
        return axios.get(api)
            .then((response) => {
                renderFunction(response.data, selectId);
            })
            .catch((error) => {
                console.error(error);
            });
    };

    let initialTotalAmount;

    initialTotalAmount = parseFloat($("#totalAmount").data("id"));

    function updateTotalAmount(newTotal, shippingFee) {
        const selectedProvinceCode = $("#province").val();
        if (selectedProvinceCode === null) {
            $("#shipping-cost").text("Vui lòng chọn địa chỉ");
            var totalAmount = new Intl.NumberFormat('vi-VN', {
                style: 'currency',
                currency: 'VND'
            }).format(initialTotalAmount);

            $("#totalAmount").text(totalAmount);
            return;
        }
        const totalAmountWithShipping = newTotal + shippingFee;

        var formattedAmount = new Intl.NumberFormat('vi-VN', {
            style: 'currency',
            currency: 'VND'
        }).format(totalAmountWithShipping);
        var shippingFee3 = new Intl.NumberFormat('vi-VN', {style: 'currency', currency: 'VND'}).format(shippingFee);

        $("#totalAmount").text(`${formattedAmount}`);
        $("#shipping-cost").text(`${shippingFee3}`);
    }

    function updateShippingFee(selectedProvinceCode) {
        if (!selectedProvinceCode) {
            $("#shipping-cost").text("Vui lòng chọn địa chỉ");
            return 0;
        } else {
            var shippingFee = 0;
            if (initialTotalAmount < 2000000) {
                shippingFee = selectedProvinceCode === "1" ? 20000 : 30000;
            }
            var formattedAmount = new Intl.NumberFormat('vi-VN', {
                style: 'currency',
                currency: 'VND'
            }).format(shippingFee);

            $("#shipping-cost").text(formattedAmount);

            $("#feeShipped").val(shippingFee);

            return shippingFee;
        }
    }

    $("#province").change(() => {
        const selectedProvinceCode = $("#province").val();

        const shippingFee = updateShippingFee(selectedProvinceCode);

        updateTotalAmount(initialTotalAmount, shippingFee);

        console.log("Initial Total:", $("#totalAmount").text());

        callAPI(host + "p/" + selectedProvinceCode + "?depth=2", "district", (data, selectId) => {
            renderOptions(data.districts, selectId, "--Chọn Quận/Huyện--");
        });

        callAPI(host + "d/" + $("#district").val() + "?depth=2", "ward", (data, selectId) => {
            renderOptions(data.wards, selectId, "--Chọn Phường/Xã--");
        });

        printResult();
    });

    $("#district").change(() => {
        callAPI(host + "d/" + $("#district").val() + "?depth=2", "ward", (data, selectId) => {
            renderOptions(data.wards, selectId, "--Chọn Phường/Xã--");
        });

        printResult();
    });

    updateTotalAmount(initialTotalAmount, calculateShippingFee());

    function calculateShippingFee() {
        var selectedProvince = '[[${session.selectedProvince}]]';
        console.log("Selected Province:", selectedProvince);
        var shippingFee = 0;
        if (initialTotalAmount < 2000000) {
            shippingFee = selectedProvince === "1" ? 20000 : 30000;
        }
        console.log("Shipping Fee:", shippingFee);

        return shippingFee;
    }

    // Initial update when the page loads
    $(document).ready(function () {
        const initialSelectedProvinceCode = $("#province").val();
        updateShippingFee(initialSelectedProvinceCode);
        updateTotalAmount(initialTotalAmount, calculateShippingFee());
    });


    $("#ward").change(() => {
        printResult();
    });

    const printResult = () => {
        if ($("#district").val() !== "" && $("#province").val() !== "" && $("#ward").val() !== "") {
            let result = $("#province option:selected").text() +
                " | " + $("#district option:selected").text() + " | " +
                $("#ward option:selected").text();
            $("#result").text(result);
        }
    };

    callAPI(host + "?depth=2", "province", (data, selectId) => {
        renderOptions(data, selectId, "--Chọn Tỉnh/Thành phố--");
        renderOptions([], "district", "--Chọn Quận/Huyện--");
        renderOptions([], "ward", "--Chọn Phường/Xã--");
    });


    if (tinh !== -1) {
        callAPI(host + "?depth=3", "province", (data, selectId) => {
            renderOptions(data, selectId, "--Chọn Tỉnh/Thành phố--");

            $("#province").val(tinh);

            callAPI(host + "p/" + tinh + "?depth=2", "district", (districtData, districtSelectId) => {
                renderOptions(districtData.districts, districtSelectId, "--Chọn Quận/Huyện--");

                $("#district").val(quan);

                callAPI(host + "d/" + quan + "?depth=2", "ward", (wardData, wardSelectId) => {
                    renderOptions(wardData.wards, wardSelectId, "--Chọn Phường/Xã--");

                    $("#ward").val(phuong);
                    printResult();
                });
            });
        });
    } else {
        renderOptions([], "district", "--Chọn Quận/Huyện--");
        renderOptions([], "ward", "--Chọn Phường/Xã--");
    }

    document.getElementById("btnThanhToan").addEventListener("click", function (event) {
        event.preventDefault();

        const formThanhToan = document.getElementById("formThanhToan");

        var loadingOverlay = document.createElement("div");
        loadingOverlay.className = "loading-overlay";
        loadingOverlay.innerHTML = '<div class="loading-spinner"></div>';
        document.body.appendChild(loadingOverlay);

        fetch("/giohangchitiet/validate-cart")
            .then(response => response.text())
            .then(result => {
                if (result === "success") {
                    var paymentMethod = document.querySelector('input[name="hinhThucThanhToan"]:checked').id;

                    if (paymentMethod === "currencyCod") {
                        let selectTinh = document.getElementById('province');
                        let selectHuyen = document.getElementById('district');
                        let selectXa = document.getElementById('ward');
                        let tinh = selectTinh.options[selectTinh.selectedIndex].textContent;
                        let huyen = selectHuyen.options[selectHuyen.selectedIndex].textContent;
                        let xa = selectXa.options[selectXa.selectedIndex].textContent;

                        let action = formThanhToan.getAttribute('action') + '?thanhPho=' + tinh + '&' + 'huyen=' + huyen + '&' + 'xa=' + xa;
                        console.log(action);
                        formThanhToan.setAttribute('action', action);
                        formThanhToan.submit();
                    } else {
                        event.preventDefault();

                        let selectTinh = document.getElementById('province');
                        let selectHuyen = document.getElementById('district');
                        let selectXa = document.getElementById('ward');
                        let tinh = selectTinh.options[selectTinh.selectedIndex].textContent;
                        let huyen = selectHuyen.options[selectHuyen.selectedIndex].textContent;
                        let xa = selectXa.options[selectXa.selectedIndex].textContent;

                        let action = formThanhToan.getAttribute('action') + '?thanhPho=' + tinh + '&' + 'huyen=' + huyen + '&' + 'xa=' + xa;
                        formThanhToan.setAttribute('action', action);
                        let tenn = document.getElementById('nameTen').value;
                        let sdtn = document.getElementById('nameSoDienThoai').value;
                        let tinhh = document.getElementById('province').value;
                        let quanHuyenn = document.getElementById('district').value;
                        let phuongXan = document.getElementById('ward').value;
                        let diaChiCuThen = document.getElementById('nameDiaChiCuThe').value;
                        if (tenn.trim().length == 0 && sdtn.trim().length == 0 &&
                            tinhh.trim().length == 0 && quanHuyenn.trim().length == 0 &&
                          phuongXan.trim().length == 0 && diaChiCuThen.trim().length == 0
                        ) {
                            formThanhToan.submit();
                        }else{
                            let actionCheck = "/giohangchitiet/kiemtraemail?email="+ document.getElementById("nameEmail").value;
                            fetch(actionCheck)
                                .then(response => response.text())
                                .then(traVe => {
                                    if (traVe == 1) {
                                        formThanhToan.submit();
                                        fetch("/api/payment/create_payment?totalAmount=" + encodeURIComponent(document.getElementById("totalAmount").innerText))
                                            .then(response => response.text())
                                            .then(paymentUrl => {
                                                console.log("Received Payment URL:", paymentUrl);
                                                document.getElementById("formThanhToan").action = paymentUrl;
                                                formThanhToan.submit();
                                            })
                                            .catch(paymentError => {
                                                console.error("Error creating payment:", paymentError);
                                                // Handle payment creation error here
                                            })
                                        document.body.removeChild(loadingOverlay);
                                    }else if(traVe == 3 || traVe == 0){
                                        formThanhToan.submit();
                                    }
                                })
                                .catch(emailError => {
                                    console.error("Error checking email:", emailError);
                                    document.body.removeChild(loadingOverlay);
                                });
                        }
                    }
                } else {
                    let type = 'error';
                    let icon = 'fa-solid fa-circle-exclamation';
                    let title = 'Thất bại!';
                    let text = result;
                    createToast(type, icon, title, text);
                    document.body.removeChild(loadingOverlay);
                }
            })
            .catch(error => {
                console.error("Error validating cart:", error);
                document.body.removeChild(loadingOverlay);
            });
    });


</script>
</body>
</html>